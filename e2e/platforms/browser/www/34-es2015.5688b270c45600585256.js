(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{"X7+O":function(l,n,e){"use strict";e.r(n);var t=e("8Y7J"),u=e("mrSG"),r=e("Pn9U"),i=e("ZZ/e"),a=e("t8sF"),o=e("18Le"),s=e("AytR"),c=e("Yttj"),b=e("iWj2"),h=e("nYR2");class p{constructor(l,n,e,t,u,r,i,a,o,c,b,h){this.camera=l,this.file=n,this.http=e,this.webview=t,this.actionSheetController=u,this.toastController=r,this.storage=i,this.plt=a,this.loadingController=o,this.ref=c,this.filePath=b,this.authenticationService=h,this.capturedImage={path:"",filePath:""},this.hasNewImage=!1,this.authenticationService.getCurrentUser().then(l=>{this.userId=l.id,this.capturedImage.path=s.a.photoUrl+l.photo})}pathForImage(l){return null===l?"":this.webview.convertFileSrc(l)}presentToast(l){return u.b(this,void 0,void 0,(function*(){(yield this.toastController.create({message:l,position:"bottom",duration:3e3})).present()}))}ngOnInit(){this.plt.ready().then(()=>{})}selectImage(){return u.b(this,void 0,void 0,(function*(){const l=yield this.actionSheetController.create({header:"Select Image source",buttons:[{text:"Load from Library",handler:()=>{this.takePicture(this.camera.PictureSourceType.PHOTOLIBRARY)}},{text:"Use Camera",handler:()=>{this.takePicture(this.camera.PictureSourceType.CAMERA)}},{text:"Cancel",role:"cancel"}]});yield l.present()}))}takePicture(l){this.camera.getPicture({quality:100,sourceType:l,saveToPhotoAlbum:!1,correctOrientation:!0}).then(n=>{if(this.plt.is("android")&&l===this.camera.PictureSourceType.PHOTOLIBRARY)this.filePath.resolveNativePath(n).then(l=>{let e=l.substr(0,l.lastIndexOf("/")+1),t=n.substring(n.lastIndexOf("/")+1,n.lastIndexOf("?"));this.copyFileToLocalDir(e,t,this.createFileName())});else{var e=n.substr(n.lastIndexOf("/")+1),t=n.substr(0,n.lastIndexOf("/")+1);this.copyFileToLocalDir(t,e,this.createFileName())}})}createFileName(){return(new Date).getTime()+".jpg"}copyFileToLocalDir(l,n,e){this.file.copyFile(l,n,this.file.dataDirectory,e).then(l=>{this.updateStoredImages(e)},l=>{this.presentToast("Error while storing file.")})}updateStoredImages(l){let n=this.file.dataDirectory+l,e={name:l,path:this.pathForImage(n),filePath:n};this.capturedImage=e,e.path&&(this.hasNewImage=!0)}startUpload(){this.file.resolveLocalFilesystemUrl(this.capturedImage.filePath).then(l=>{l.file(l=>this.readFile(l))}).catch(l=>{this.presentToast("Error while reading file.")})}readFile(l){const n=new FileReader;n.onload=()=>{const e=new FormData,t=new Blob([n.result],{type:l.type});e.append("file",t,l.name),e.append("userId",this.userId),this.uploadImageData(e)},n.readAsArrayBuffer(l)}uploadImageData(l){return u.b(this,void 0,void 0,(function*(){const n=yield this.loadingController.create({message:"Uploading image..."});yield n.present(),this.http.post(`${s.a.url}/user/photo`,l).pipe(Object(h.a)(()=>{n.dismiss()})).subscribe(l=>{this.presentToast(l.error?"File upload failed.":"Your profile photo was update successfully")})}))}}class d{}var m=e("pMnS"),f=e("oBZk"),g=e("SVse"),k=e("IheW"),I=e("xgBC"),y=t.pb({encapsulation:0,styles:[[""]],data:{}});function v(l){return t.Lb(0,[(l()(),t.rb(0,0,null,null,3,"ion-buttons",[["padding",""],["slot","end"]],null,[[null,"click"]],(function(l,n,e){var t=!0;return"click"===n&&(t=!1!==l.component.startUpload()&&t),t}),f.Q,f.f)),t.qb(1,49152,null,0,i.m,[t.h,t.k,t.x],null,null),t.qb(2,16384,null,0,i.e,[t.k],null,null),(l()(),t.Jb(-1,0,[" Save "]))],null,null)}function x(l){return t.Lb(0,[(l()(),t.rb(0,0,null,null,13,"ion-header",[],null,null,null,f.bb,f.q)),t.qb(1,49152,null,0,i.C,[t.h,t.k,t.x],null,null),(l()(),t.rb(2,0,null,0,11,"ion-toolbar",[["color","primary"]],null,null,null,f.vb,f.K)),t.qb(3,49152,null,0,i.Db,[t.h,t.k,t.x],{color:[0,"color"]},null),(l()(),t.rb(4,0,null,0,2,"ion-title",[],null,null,null,f.ub,f.J)),t.qb(5,49152,null,0,i.Bb,[t.h,t.k,t.x],null,null),(l()(),t.Jb(-1,0,["Profile Photo"])),(l()(),t.rb(7,0,null,0,4,"ion-buttons",[["slot","start"]],null,null,null,f.Q,f.f)),t.qb(8,49152,null,0,i.m,[t.h,t.k,t.x],null,null),(l()(),t.rb(9,0,null,0,2,"ion-back-button",[],null,[[null,"click"]],(function(l,n,e){var u=!0;return"click"===n&&(u=!1!==t.Db(l,11).onClick(e)&&u),u}),f.N,f.c)),t.qb(10,49152,null,0,i.h,[t.h,t.k,t.x],null,null),t.qb(11,16384,null,0,i.i,[[2,i.jb],i.Jb],null,null),(l()(),t.gb(16777216,null,0,1,null,v)),t.qb(13,16384,null,0,g.j,[t.M,t.J],{ngIf:[0,"ngIf"]},null),(l()(),t.rb(14,0,null,null,15,"ion-content",[["fullscreen",""],["padding",""]],null,null,null,f.X,f.m)),t.qb(15,49152,null,0,i.v,[t.h,t.k,t.x],{fullscreen:[0,"fullscreen"]},null),t.qb(16,16384,null,0,i.e,[t.k],null,null),(l()(),t.rb(17,0,null,0,12,"ion-card",[],null,null,null,f.V,f.g)),t.qb(18,49152,null,0,i.n,[t.h,t.k,t.x],null,null),(l()(),t.rb(19,0,null,0,10,"ion-grid",[],null,null,null,f.ab,f.p)),t.qb(20,49152,null,0,i.B,[t.h,t.k,t.x],null,null),(l()(),t.rb(21,0,null,0,8,"ion-row",[["color","primary"],["justify-content-center",""]],null,null,null,f.nb,f.C)),t.qb(22,49152,null,0,i.kb,[t.h,t.k,t.x],null,null),t.qb(23,16384,null,0,i.e,[t.k],null,null),(l()(),t.rb(24,0,null,0,5,"ion-col",[["align-self-center",""],["size-lg","5"],["size-md","6"],["size-xs","12"]],null,null,null,f.W,f.l)),t.qb(25,49152,null,0,i.u,[t.h,t.k,t.x],null,null),t.qb(26,16384,null,0,i.e,[t.k],null,null),(l()(),t.rb(27,0,null,0,2,"div",[["text-center",""]],null,null,null,null,null)),t.qb(28,16384,null,0,i.e,[t.k],null,null),(l()(),t.rb(29,0,null,null,0,"img",[],[[8,"src",4]],null,null,null,null)),(l()(),t.rb(30,0,null,null,9,"ion-footer",[["padding",""]],null,null,null,f.Z,f.o)),t.qb(31,49152,null,0,i.A,[t.h,t.k,t.x],null,null),t.qb(32,16384,null,0,i.e,[t.k],null,null),(l()(),t.rb(33,0,null,0,6,"ion-toolbar",[],null,null,null,f.vb,f.K)),t.qb(34,49152,null,0,i.Db,[t.h,t.k,t.x],null,null),(l()(),t.rb(35,0,null,0,4,"ion-button",[["color","primary"],["expand","block"]],null,[[null,"click"]],(function(l,n,e){var t=!0;return"click"===n&&(t=!1!==l.component.selectImage()&&t),t}),f.P,f.e)),t.qb(36,49152,null,0,i.l,[t.h,t.k,t.x],{color:[0,"color"],expand:[1,"expand"]},null),(l()(),t.rb(37,0,null,0,1,"ion-icon",[["name","camera"],["size","large"],["slot","start"]],null,null,null,f.cb,f.r)),t.qb(38,49152,null,0,i.D,[t.h,t.k,t.x],{name:[0,"name"],size:[1,"size"]},null),(l()(),t.Jb(-1,0,[" Select Image"]))],(function(l,n){var e=n.component;l(n,3,0,"primary"),l(n,13,0,e.hasNewImage),l(n,15,0,""),l(n,36,0,"primary","block"),l(n,38,0,"camera","large")}),(function(l,n){l(n,29,0,n.component.capturedImage.path)}))}function q(l){return t.Lb(0,[(l()(),t.rb(0,0,null,null,1,"app-photo",[],null,null,null,x,y)),t.qb(1,114688,null,0,p,[r.a,a.a,k.c,c.a,i.a,i.Qb,I.b,i.Lb,i.Hb,t.h,b.a,o.a],null,null)],(function(l,n){l(n,1,0)}),null)}var P=t.nb("app-photo",p,q,{},{},[]),w=e("s7LF"),B=e("iInd");e.d(n,"PhotoPageModuleNgFactory",(function(){return F}));var F=t.ob(d,[],(function(l){return t.Ab([t.Bb(512,t.j,t.Z,[[8,[m.a,P]],[3,t.j],t.v]),t.Bb(4608,g.l,g.k,[t.s,[2,g.r]]),t.Bb(4608,w.l,w.l,[]),t.Bb(4608,i.c,i.c,[t.x,t.g]),t.Bb(4608,i.Ib,i.Ib,[i.c,t.j,t.p]),t.Bb(4608,i.Mb,i.Mb,[i.c,t.j,t.p]),t.Bb(1073742336,g.b,g.b,[]),t.Bb(1073742336,w.k,w.k,[]),t.Bb(1073742336,w.b,w.b,[]),t.Bb(1073742336,i.Fb,i.Fb,[]),t.Bb(1073742336,B.o,B.o,[[2,B.t],[2,B.m]]),t.Bb(1073742336,d,d,[]),t.Bb(1024,B.k,(function(){return[[{path:"",component:p}]]}),[])])}))}}]);